<project name="tracer" default="services_recompile" basedir=".">

	<property file="user.properties" />
	<property file="common.properties" />
	<property environment="env" />
	<property name="lib" value="lib/jars" />
	<property name="lib.build-client.dir" value="${root.dir}\\lib" />
	
	<patternset id="jar.files">
		<include name="**/*.jar" />
		<include name="**/*.zip" />
	</patternset>

	<path id="base.libraries">
		<pathelement location="${build.classes}" />
		<fileset dir="${axis2.home}\lib">
			<include name="*.jar" />
		</fileset>
	</path>

	<path id="project.classpath">
		<fileset dir="${basedir}/lib">
			<patternset refid="jar.files" />
		</fileset>
		<fileset dir="${basedir}/lib/jars">
			<patternset refid="jar.files" />
		</fileset>		
	</path>
	
	<property name="axis2.classpath" value="base.libraries" />
	<property name="build.dir" value="${root.dir}\\bin" />

	<target name="services_recompile">
		<antcall target="services_java2wsdl" />
		<antcall target="services_wsdl2java" />
	</target>

	
	<target name="services_java2wsdl">
		<taskdef name="Java2WSDLTask" classname="org.apache.ws.java2wsdl.Java2WSDLTask" classpathref="${axis2.classpath}" />
		<Java2WSDLTask classPath="${build.dir}" className="aero.nettracer.serviceprovider.ws_1_0.ReservationService_1_0" outputLocation="src/aero/nettracer/serviceprovider/ws_1_0" outputFileName="ReservationService_1_0.wsdl">
		</Java2WSDLTask>
	</target>

	<target name="services_wsdl2java">
		<java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true" classpathref="${axis2.classpath}">
			<arg value="-uri" />
			<arg file="src/aero/nettracer/serviceprovider/ws_1_0/ReservationService_1_0.wsdl" />
			<arg value="-o" />
			<arg file="${build.dir}/webservices/NTService" />
			<arg value="-ss" />
			<arg value="-sd" />
			<arg value="-g" />
			<arg value="-d" />
			<arg value="xmlbeans" />
		</java>

		<!-- copy services.xml to web-inf -->
		<copy todir="${basedir}/web/WEB-INF/services/NTService/META-INF" file="${build.dir}/webservices/NTService/resources/services.xml" />

		<!-- copy java files to src -->

		<copy todir="${basedir}/src">
			<fileset dir="${build.dir}/webservices/NTService/src">
				<include name="**/**/*.java" />
				<exclude name="**/org/**" />
			</fileset>
		</copy>



		<!-- make jar file for schema -->

		<mkdir dir="${build.dir}/webservices/NTService/temp" />
		<move todir="${build.dir}/webservices/NTService/temp">
			<fileset dir="${build.dir}/webservices/NTService/resources">
				<include name="*schema*/**/*.class" />
				<include name="*schema*/**/*.xsb" />
			</fileset>
		</move>

		<jar destfile="${build.dir}/webservices/NTService/ReservationService_1_0.jar" basedir="${build.dir}/webservices/NTService/temp">
		</jar>

		<move todir="${basedir}/lib/jars" file="${build.dir}/webservices/NTService/ReservationService_1_0.jar" />

		<!-- clean up -->

		<delete dir="${build.dir}/webservices/NTService/temp" />
		<delete dir="${build.dir}/webservices/NTService/resources" />
		<delete dir="${build.dir}/webservices/NTService/src" />
	</target>
	
	<taskdef name="hibernatetool" classname="org.hibernate.tool.ant.HibernateToolTask" classpathref="project.classpath" />
	
	<target name="schemaexport" description="Exports a generated schema to file">
		<hibernatetool destdir="${build.dir}">
			<classpath>
				<path refid="project.classpath" />
				<path location="${build.dir}" />
			</classpath>
			<annotationconfiguration configurationfile="${build.dir}/hibernate_main.cfg.xml" />
			<hbm2ddl drop="true" create="true" export="false" outputfilename="central-svc-ddl.sql" delimiter=";" format="true" />
		</hibernatetool>
	</target>

</project>
