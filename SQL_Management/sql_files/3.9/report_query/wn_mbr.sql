#MBR Query for losscodes 1-99 for all stations regardless of active state
#startdate - Incident createdate start range.
#enddate - Incident createdate end range.

select 
	stationinfo.*, 
	ifnull(losscodes.lc1,0) lc1,
	ifnull(losscodes.lc2,0) lc2,
	ifnull(losscodes.lc3,0) lc3,
	ifnull(losscodes.lc4,0) lc4,
	ifnull(losscodes.lc5,0) lc5,
	ifnull(losscodes.lc6,0) lc6,
	ifnull(losscodes.lc7,0) lc7,
	ifnull(losscodes.lc8,0) lc8,
	ifnull(losscodes.lc9,0) lc9,
	ifnull(losscodes.lc10,0) lc10,
	ifnull(losscodes.lc11,0) lc11,
	ifnull(losscodes.lc12,0) lc12,
	ifnull(losscodes.lc13,0) lc13,
	ifnull(losscodes.lc14,0) lc14,
	ifnull(losscodes.lc15,0) lc15,
	ifnull(losscodes.lc16,0) lc16,
	ifnull(losscodes.lc17,0) lc17,
	ifnull(losscodes.lc18,0) lc18,
	ifnull(losscodes.lc19,0) lc19,
	ifnull(losscodes.lc20,0) lc20,
	ifnull(losscodes.lc21,0) lc21,
	ifnull(losscodes.lc22,0) lc22,
	ifnull(losscodes.lc23,0) lc23,
	ifnull(losscodes.lc24,0) lc24,
	ifnull(losscodes.lc25,0) lc25,
	ifnull(losscodes.lc26,0) lc26,
	ifnull(losscodes.lc27,0) lc27,
	ifnull(losscodes.lc28,0) lc28,
	ifnull(losscodes.lc29,0) lc29,
	ifnull(losscodes.lc30,0) lc30,
	ifnull(losscodes.lc31,0) lc31,
	ifnull(losscodes.lc32,0) lc32,
	ifnull(losscodes.lc33,0) lc33,
	ifnull(losscodes.lc34,0) lc34,
	ifnull(losscodes.lc35,0) lc35,
	ifnull(losscodes.lc36,0) lc36,
	ifnull(losscodes.lc37,0) lc37,
	ifnull(losscodes.lc38,0) lc38,
	ifnull(losscodes.lc39,0) lc39,
	ifnull(losscodes.lc40,0) lc40,
	ifnull(losscodes.lc41,0) lc41,
	ifnull(losscodes.lc42,0) lc42,
	ifnull(losscodes.lc43,0) lc43,
	ifnull(losscodes.lc44,0) lc44,
	ifnull(losscodes.lc45,0) lc45,
	ifnull(losscodes.lc46,0) lc46,
	ifnull(losscodes.lc47,0) lc47,
	ifnull(losscodes.lc48,0) lc48,
	ifnull(losscodes.lc49,0) lc49,
	ifnull(losscodes.lc50,0) lc50,
	ifnull(losscodes.lc51,0) lc51,
	ifnull(losscodes.lc52,0) lc52,
	ifnull(losscodes.lc53,0) lc53,
	ifnull(losscodes.lc54,0) lc54,
	ifnull(losscodes.lc55,0) lc55,
	ifnull(losscodes.lc56,0) lc56,
	ifnull(losscodes.lc57,0) lc57,
	ifnull(losscodes.lc58,0) lc58,
	ifnull(losscodes.lc59,0) lc59,
	ifnull(losscodes.lc60,0) lc60,
	ifnull(losscodes.lc61,0) lc61,
	ifnull(losscodes.lc62,0) lc62,
	ifnull(losscodes.lc63,0) lc63,
	ifnull(losscodes.lc64,0) lc64,
	ifnull(losscodes.lc65,0) lc65,
	ifnull(losscodes.lc66,0) lc66,
	ifnull(losscodes.lc67,0) lc67,
	ifnull(losscodes.lc68,0) lc68,
	ifnull(losscodes.lc69,0) lc69,
	ifnull(losscodes.lc70,0) lc70,
	ifnull(losscodes.lc71,0) lc71,
	ifnull(losscodes.lc72,0) lc72,
	ifnull(losscodes.lc73,0) lc73,
	ifnull(losscodes.lc74,0) lc74,
	ifnull(losscodes.lc75,0) lc75,
	ifnull(losscodes.lc76,0) lc76,
	ifnull(losscodes.lc77,0) lc77,
	ifnull(losscodes.lc78,0) lc78,
	ifnull(losscodes.lc79,0) lc79,
	ifnull(losscodes.lc80,0) lc80,
	ifnull(losscodes.lc81,0) lc81,
	ifnull(losscodes.lc82,0) lc82,
	ifnull(losscodes.lc83,0) lc83,
	ifnull(losscodes.lc84,0) lc84,
	ifnull(losscodes.lc85,0) lc85,
	ifnull(losscodes.lc86,0) lc86,
	ifnull(losscodes.lc87,0) lc87,
	ifnull(losscodes.lc88,0) lc88,
	ifnull(losscodes.lc89,0) lc89,
	ifnull(losscodes.lc90,0) lc90,
	ifnull(losscodes.lc91,0) lc91,
	ifnull(losscodes.lc92,0) lc92,
	ifnull(losscodes.lc93,0) lc93,
	ifnull(losscodes.lc94,0) lc94,
	ifnull(losscodes.lc95,0) lc95,
	ifnull(losscodes.lc96,0) lc96,
	ifnull(losscodes.lc97,0) lc97,
	ifnull(losscodes.lc98,0) lc98,
	ifnull(losscodes.lc99,0) lc99
from 

(
	select 
	  s.stationcode as station_code,
	  s.countrycode_ID as country_code,
	  s.goal as station_goal, 
	  r.name as region_name, 
	  r.director as region_director, 
	  r.target as region_goal, 
	  r.active as region_active  
	from station s
	left outer join region r on s.Station_ID = r.id
	where s.companycode_ID = 'WN'
) stationinfo

left outer join 

(
	select 
	  s.stationcode, 
	 sum(case when it.losscode = 1 then 1 else 0 end) lc1,
	 sum(case when it.losscode = 2 then 1 else 0 end) lc2,
	 sum(case when it.losscode = 3 then 1 else 0 end) lc3,
	 sum(case when it.losscode = 4 then 1 else 0 end) lc4,
	 sum(case when it.losscode = 5 then 1 else 0 end) lc5,
	 sum(case when it.losscode = 6 then 1 else 0 end) lc6,
	 sum(case when it.losscode = 7 then 1 else 0 end) lc7,
	 sum(case when it.losscode = 8 then 1 else 0 end) lc8,
	 sum(case when it.losscode = 9 then 1 else 0 end) lc9,
	 sum(case when it.losscode = 10 then 1 else 0 end) lc10,
	 sum(case when it.losscode = 11 then 1 else 0 end) lc11,
	 sum(case when it.losscode = 12 then 1 else 0 end) lc12,
	 sum(case when it.losscode = 13 then 1 else 0 end) lc13,
	 sum(case when it.losscode = 14 then 1 else 0 end) lc14,
	 sum(case when it.losscode = 15 then 1 else 0 end) lc15,
	 sum(case when it.losscode = 16 then 1 else 0 end) lc16,
	 sum(case when it.losscode = 17 then 1 else 0 end) lc17,
	 sum(case when it.losscode = 18 then 1 else 0 end) lc18,
	 sum(case when it.losscode = 19 then 1 else 0 end) lc19,
	 sum(case when it.losscode = 20 then 1 else 0 end) lc20,
	 sum(case when it.losscode = 21 then 1 else 0 end) lc21,
	 sum(case when it.losscode = 22 then 1 else 0 end) lc22,
	 sum(case when it.losscode = 23 then 1 else 0 end) lc23,
	 sum(case when it.losscode = 24 then 1 else 0 end) lc24,
	 sum(case when it.losscode = 25 then 1 else 0 end) lc25,
	 sum(case when it.losscode = 26 then 1 else 0 end) lc26,
	 sum(case when it.losscode = 27 then 1 else 0 end) lc27,
	 sum(case when it.losscode = 28 then 1 else 0 end) lc28,
	 sum(case when it.losscode = 29 then 1 else 0 end) lc29,
	 sum(case when it.losscode = 30 then 1 else 0 end) lc30,
	 sum(case when it.losscode = 31 then 1 else 0 end) lc31,
	 sum(case when it.losscode = 32 then 1 else 0 end) lc32,
	 sum(case when it.losscode = 33 then 1 else 0 end) lc33,
	 sum(case when it.losscode = 34 then 1 else 0 end) lc34,
	 sum(case when it.losscode = 35 then 1 else 0 end) lc35,
	 sum(case when it.losscode = 36 then 1 else 0 end) lc36,
	 sum(case when it.losscode = 37 then 1 else 0 end) lc37,
	 sum(case when it.losscode = 38 then 1 else 0 end) lc38,
	 sum(case when it.losscode = 39 then 1 else 0 end) lc39,
	 sum(case when it.losscode = 40 then 1 else 0 end) lc40,
	 sum(case when it.losscode = 41 then 1 else 0 end) lc41,
	 sum(case when it.losscode = 42 then 1 else 0 end) lc42,
	 sum(case when it.losscode = 43 then 1 else 0 end) lc43,
	 sum(case when it.losscode = 44 then 1 else 0 end) lc44,
	 sum(case when it.losscode = 45 then 1 else 0 end) lc45,
	 sum(case when it.losscode = 46 then 1 else 0 end) lc46,
	 sum(case when it.losscode = 47 then 1 else 0 end) lc47,
	 sum(case when it.losscode = 48 then 1 else 0 end) lc48,
	 sum(case when it.losscode = 49 then 1 else 0 end) lc49,
	 sum(case when it.losscode = 50 then 1 else 0 end) lc50,
	 sum(case when it.losscode = 51 then 1 else 0 end) lc51,
	 sum(case when it.losscode = 52 then 1 else 0 end) lc52,
	 sum(case when it.losscode = 53 then 1 else 0 end) lc53,
	 sum(case when it.losscode = 54 then 1 else 0 end) lc54,
	 sum(case when it.losscode = 55 then 1 else 0 end) lc55,
	 sum(case when it.losscode = 56 then 1 else 0 end) lc56,
	 sum(case when it.losscode = 57 then 1 else 0 end) lc57,
	 sum(case when it.losscode = 58 then 1 else 0 end) lc58,
	 sum(case when it.losscode = 59 then 1 else 0 end) lc59,
	 sum(case when it.losscode = 60 then 1 else 0 end) lc60,
	 sum(case when it.losscode = 61 then 1 else 0 end) lc61,
	 sum(case when it.losscode = 62 then 1 else 0 end) lc62,
	 sum(case when it.losscode = 63 then 1 else 0 end) lc63,
	 sum(case when it.losscode = 64 then 1 else 0 end) lc64,
	 sum(case when it.losscode = 65 then 1 else 0 end) lc65,
	 sum(case when it.losscode = 66 then 1 else 0 end) lc66,
	 sum(case when it.losscode = 67 then 1 else 0 end) lc67,
	 sum(case when it.losscode = 68 then 1 else 0 end) lc68,
	 sum(case when it.losscode = 69 then 1 else 0 end) lc69,
	 sum(case when it.losscode = 70 then 1 else 0 end) lc70,
	 sum(case when it.losscode = 71 then 1 else 0 end) lc71,
	 sum(case when it.losscode = 72 then 1 else 0 end) lc72,
	 sum(case when it.losscode = 73 then 1 else 0 end) lc73,
	 sum(case when it.losscode = 74 then 1 else 0 end) lc74,
	 sum(case when it.losscode = 75 then 1 else 0 end) lc75,
	 sum(case when it.losscode = 76 then 1 else 0 end) lc76,
	 sum(case when it.losscode = 77 then 1 else 0 end) lc77,
	 sum(case when it.losscode = 78 then 1 else 0 end) lc78,
	 sum(case when it.losscode = 79 then 1 else 0 end) lc79,
	 sum(case when it.losscode = 80 then 1 else 0 end) lc80,
	 sum(case when it.losscode = 81 then 1 else 0 end) lc81,
	 sum(case when it.losscode = 82 then 1 else 0 end) lc82,
	 sum(case when it.losscode = 83 then 1 else 0 end) lc83,
	 sum(case when it.losscode = 84 then 1 else 0 end) lc84,
	 sum(case when it.losscode = 85 then 1 else 0 end) lc85,
	 sum(case when it.losscode = 86 then 1 else 0 end) lc86,
	 sum(case when it.losscode = 87 then 1 else 0 end) lc87,
	 sum(case when it.losscode = 88 then 1 else 0 end) lc88,
	 sum(case when it.losscode = 89 then 1 else 0 end) lc89,
	 sum(case when it.losscode = 90 then 1 else 0 end) lc90,
	 sum(case when it.losscode = 91 then 1 else 0 end) lc91,
	 sum(case when it.losscode = 92 then 1 else 0 end) lc92,
	 sum(case when it.losscode = 93 then 1 else 0 end) lc93,
	 sum(case when it.losscode = 94 then 1 else 0 end) lc94,
	 sum(case when it.losscode = 95 then 1 else 0 end) lc95,
	 sum(case when it.losscode = 96 then 1 else 0 end) lc96,
	 sum(case when it.losscode = 97 then 1 else 0 end) lc97,
	 sum(case when it.losscode = 98 then 1 else 0 end) lc98,
	 sum(case when it.losscode = 99 then 1 else 0 end) lc99
	from incident i
	left outer join station s on i.stationcreated_ID = s.station_id
	left outer join item it on it.incident_ID = i.Incident_ID
	left outer join item it2 on (it2.incident_id = i.incident_id and it.item_id > it2.item_id)
	where i.createdate between :startdate and :enddate
	and it2.item_id is null
	group by s.stationcode
) losscodes

on stationinfo.station_code = losscodes.stationcode
order by stationinfo.region_name, stationinfo.station_code asc
;