/*
*   jQuery.CustomCombobox
*   ----------------------
*   version: 1.2.1
*   date: 2/10/10
*
*   Copyright (c) 2010 Donny Velazquez
*   http://www.ComicsInventory.com   
*   http://donnyvblog.blogspot.com/
*   http://code.google.com/p/custom-combobox
*   
*   Licensed under the Apache License 2.0
*
*/ 
(function(f){f.fn.customcombobox=function(h,g){var g=f.extend({},f.fn.customcombobox.defaults,g);return this.each(function(){var j=g;var m=f(this);var t=f("li",m);if(t.length!=0){}else{var u="<div class='CustomCombobox'>";u+="<div class='cc-Box'>";u+="<input type='text' class='cc-Textbox' value='' readonly='readonly'/><span class='cc-Arrow'></span>";u+="</div>";var q="<div class='cc-ItemListContainer'><ul class='cc-ItemList'></ul></div></div>";var r=m.html(u+q);if(h.length==0){return}for(i=0;i<=h.length-1;i++){var k=null;if(typeof(h[0])!="object"&&j.template==""){k=f("<li class='cc-Item'>"+h[i]+"</li>");k.data("source",h[i])}if(typeof(h[0])!="object"&&j.template!=""){k=f("<li class='cc-Item'>"+d(h[i],j.template)+"</li>");k.data("source",h[i])}if(typeof(h[0])=="object"&&j.template==""&&j.displayPropertyName!=""){k=f("<li class='cc-Item'>"+h[i][j.displayPropertyName]+"</li>");k.data("source",h[i])}if(typeof(h[0])=="object"&&j.template!=""){k=f("<li class='cc-Item'>"+d(h[i],j.template)+"</li>");k.data("source",h[i])}r.find(".cc-ItemList").append(k)}if(j.topMsg!=""){r.find(".cc-Textbox").val(j.topMsg)}if(j.topMsg==""&&j.initialIndex!=-1){if(j.displayPropertyName!=""){r.find(".cc-Textbox").val(h[j.initialIndex][j.displayPropertyName])}else{r.find(".cc-Textbox").val(h[i])}}if(j.topMsg==""&&j.initialIndex==-1&&j.initialValue!=""){for(i=0;i<=h.length-1;i++){if(typeof(h[0])=="object"&&j.displayPropertyName!=""){if(h[i][j.displayPropertyName]==j.initialValue){r.find(".cc-Textbox").val(h[i][j.displayPropertyName])}}if(typeof(h[0])!="object"){if(h[i]==j.initialValue){r.find(".cc-Textbox").val(h[i])}}}}if(j.topMsg==""&&j.initialIndex==-1&&j.initialValue==""&&j.displayPropertyName!=""&&j.idPropertyName!=""&&j.initialValueByID!=""){for(i=0;i<=h.length-1;i++){if(typeof(h[0])=="object"){if(h[i][j.idPropertyName]==j.initialValueByID){r.find(".cc-Textbox").val(h[i][j.displayPropertyName])}}}}var s=f("span[class=cc-Arrow]",r);s.click(function(){c(f(this),j)});var p=f("input",r);p.click(function(){c(f(this),j)});var l=f("div[class=cc-ItemListContainer]",r);l.hover(null,function(){b(f(this))});var n=f("li[class=cc-Item]",r);n.click(function(){a(f(this),j)})}})};f.fn.setSelectedIndex=function(g){};f.fn.setSelectedValue=function(g){};f.fn.setSelectedValueByID=function(g){};function d(g,h){if(g===""){return this}return h.replace(/{([^{}]*)}/g,function(k,j){if(typeof(g)=="object"){return g[j]}else{return g}})}function c(l,u){var p=f(window).height();var o=f(window).width();var q=f(window).scrollTop();var n=l.parents(".CustomCombobox");var g=n.find(".cc-Textbox");var s=g.offset().top+g.height()+2;var t=g.offset().left;var r;if(u.width!=-1){r=u.width}else{r=e(l)}var m=0;n.find(".cc-ItemListContainer").css({border:"0px white solid",display:"block",visibility:"hidden"});n.find(".cc-Item").each(function(h){m=m+f(this).outerHeight(true);if(h==u.maxVisibleRows-1){return false}});n.find(".cc-ItemListContainer").removeAttr("style").hide();if(u.useEdgeDetection){if((t+r)>o){r=(t+r)-((t+r)-o)-t-2-2}var j=(q+p)-s;var k=g.offset().top-q;if(m>j){if(m<k){s=g.offset().top-m}else{m=Math.max(j,k);switch(m){case k:s=g.offset().top-m;break}}}}n.find(".cc-ItemListContainer").width(r);n.find(".cc-ItemListContainer").css({top:s,left:t}).animate({height:m+"px"},100)}function b(g){g.hide()}function a(k,h){if(h){var g=k.parents(".CustomCombobox");var j=k.data("source");if(typeof(j)=="object"){g.find(".cc-Textbox").val(j[h.displayPropertyName])}else{g.find(".cc-Textbox").val(j)}g.find(".cc-ItemListContainer").hide();h.onSelect(k)}}function e(h){var g=h.parents(".CustomCombobox");return g.find(".cc-Textbox").width()+g.find(".cc-Arrow").width()+5}f.fn.customcombobox.defaults={width:-1,template:"",topMsg:"",displayPropertyName:"",initialIndex:-1,initialValue:"",idPropertyName:"",initialValueByID:"",maxVisibleRows:-1,useEdgeDetection:true,onSelect:false}})(jQuery);